<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Laravel 集合(Collection)源代码分析 | blog</title>
    <meta name="generator" content="VuePress 1.5.0">
    
    <meta name="description" content="Vuepress blog demo">
    <link rel="preload" href="/blog/assets/css/0.styles.f9b52b88.css" as="style"><link rel="preload" href="/blog/assets/js/app.60399f4f.js" as="script"><link rel="preload" href="/blog/assets/js/2.3312aabc.js" as="script"><link rel="preload" href="/blog/assets/js/6.6ba50660.js" as="script"><link rel="prefetch" href="/blog/assets/js/3.1aeedeb0.js"><link rel="prefetch" href="/blog/assets/js/4.2b7fc900.js"><link rel="prefetch" href="/blog/assets/js/5.0b5e05ba.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.f9b52b88.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/hhpp33/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    My GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/hhpp33/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    My GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/blog/" aria-current="page" class="sidebar-link">首页</a></li><li><a href="/blog/blog/collection.html" aria-current="page" class="active sidebar-link">Laravel 集合(Collection)源代码分析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/blog/collection.html#简介" class="sidebar-link">简介</a></li><li class="sidebar-sub-header"><a href="/blog/blog/collection.html#collection集合类实现了6个接口和引用了1个特性" class="sidebar-link">collection集合类实现了6个接口和引用了1个特性</a></li><li class="sidebar-sub-header"><a href="/blog/blog/collection.html#常用方法" class="sidebar-link">常用方法</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="laravel-集合-collection-源代码分析"><a href="#laravel-集合-collection-源代码分析" class="header-anchor">#</a> Laravel 集合(Collection)源代码分析</h1> <h2 id="简介"><a href="#简介" class="header-anchor">#</a> 简介</h2> <p>Illuminate\Support\Collection 类为处理数组数据提供了流式、方便的封装。处理一组数组时，帮助你快捷的解决实际问题。其实Laravel的内核大部分的参数传递都用到了集合。</p> <h2 id="collection集合类实现了6个接口和引用了1个特性"><a href="#collection集合类实现了6个接口和引用了1个特性" class="header-anchor">#</a> collection集合类实现了6个接口和引用了1个特性</h2> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name">Collection</span> <span class="token keyword">implements</span> <span class="token class-name">ArrayAccess</span><span class="token punctuation">,</span> Arrayable<span class="token punctuation">,</span> Countable<span class="token punctuation">,</span> IteratorAggregate<span class="token punctuation">,</span> Jsonable<span class="token punctuation">,</span> JsonSerializable
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">Macroable</span><span class="token punctuation">;</span>
</span></code></pre></div><p>接口</p> <ul><li>1、php内置的ArrayAccess 数组式访问接口</li> <li>2、自定义的Arrayable 集合转化成数组接口</li> <li>3、php内置的Countable 统计对象的public属性的总数接口</li> <li>4、php内置的IteratorAggregate 迭代器接口</li> <li>5、自定义的Jsonable 集合转json接口</li> <li>6、php内置的JsonSerializable 对对象的public属性进行json序列化接口</li></ul> <p>特性</p> <ul><li>1、利用 Macroable Trait 对collection进行扩展功能</li></ul> <h2 id="常用方法"><a href="#常用方法" class="header-anchor">#</a> 常用方法</h2> <h3 id="_1、all方法，返回本对象包装的数组"><a href="#_1、all方法，返回本对象包装的数组" class="header-anchor">#</a> 1、all方法，返回本对象包装的数组</h3> <div class="language-php extra-class"><pre class="language-php"><code>   <span class="token comment">/**
     * 返回本对象集合
     * @return array
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span> 
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">items</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre></div><h3 id="_2、count方法，返回本集合数量"><a href="#_2、count方法，返回本集合数量" class="header-anchor">#</a> 2、count方法，返回本集合数量</h3> <div class="language-php extra-class"><pre class="language-php"><code>   <span class="token comment">/**
     * 返回本集合数量
     * @return array
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span> 
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">items</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre></div><h3 id="_3、sum方法，返回集合内所有项目的总和"><a href="#_3、sum方法，返回集合内所有项目的总和" class="header-anchor">#</a> 3、sum方法，返回集合内所有项目的总和</h3> <div class="language-php extra-class"><pre class="language-php"><code>   <span class="token comment">/**
     * 返回集合内所有项目的总和
     * @param  callable|string|null  $callback
     * @return mixed
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token variable">$callback</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 判断$callback为null返回集合内所有项目的总和</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_null</span><span class="token punctuation">(</span><span class="token variable">$callback</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">array_sum</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">items</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//调用valueRetriever方法处理$callback参数，若$callback参数是一个闭包，返回的数据是一个闭包。若 $callback 参数是字符串，返回的闭包可以用来检索键名为$callback的数据</span>
        <span class="token variable">$callback</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">valueRetriever</span><span class="token punctuation">(</span><span class="token variable">$callback</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">,</span> <span class="token variable">$item</span><span class="token punctuation">)</span> <span class="token keyword">use</span> <span class="token punctuation">(</span><span class="token variable">$callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 调用reduce方法处理每一个数据，返回闭包处理后的数据</span>
            <span class="token keyword">return</span> <span class="token variable">$result</span> <span class="token operator">+</span> <span class="token variable">$callback</span><span class="token punctuation">(</span><span class="token variable">$item</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre></div><h3 id="_4、average-avg方法，计算集合项的平均值"><a href="#_4、average-avg方法，计算集合项的平均值" class="header-anchor">#</a> 4、average &amp; avg方法，计算集合项的平均值</h3> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
     * 计算集合项的平均值
     * @param  callable|string|null  $callback
     * @return mixed
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">avg</span><span class="token punctuation">(</span><span class="token variable">$callback</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//返回集合数量</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$count</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 返回计算后的集合项平均值，公试：集合内所有项目的总和 / 集合数量</span>
            <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token variable">$callback</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token variable">$count</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

</code></pre></div><h3 id="_5、chunk方法，将集合拆成多个指定大小的小集合"><a href="#_5、chunk方法，将集合拆成多个指定大小的小集合" class="header-anchor">#</a> 5、chunk方法，将集合拆成多个指定大小的小集合</h3> <div class="language-php extra-class"><pre class="language-php"><code> <span class="token comment">/**
     * 将集合拆成多个指定大小的小集合
     * @param  int  $size
     * @return static
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">chunk</span><span class="token punctuation">(</span><span class="token variable">$size</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// $size为小于等于0时，返回当前对象实例</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$size</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">static</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token variable">$chunks</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">// 遍历将一个集合分割成多个小尺寸的小集合</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token function">array_chunk</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">items</span><span class="token punctuation">,</span> <span class="token variable">$size</span><span class="token punctuation">,</span> <span class="token boolean constant">true</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token variable">$chunk</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token comment">// 每个小集合new 个实例</span>
            <span class="token variable">$chunks</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">static</span><span class="token punctuation">(</span><span class="token variable">$chunk</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 大集合new 个实例</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">static</span><span class="token punctuation">(</span><span class="token variable">$chunks</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre></div><h3 id="_6、each方法，迭代集合中的内容并将其传递到回调函数中"><a href="#_6、each方法，迭代集合中的内容并将其传递到回调函数中" class="header-anchor">#</a> 6、each方法，迭代集合中的内容并将其传递到回调函数中</h3> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
     * 迭代集合中的内容并将其传递到回调函数中
     * @param  callable  $callback
     * @return $this
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">callable</span> <span class="token variable">$callback</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//遍历集合中的内容并将其传递到回调函数中</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">items</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 回调函数处理后的结果等于false跳出循环</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$callback</span><span class="token punctuation">(</span><span class="token variable">$item</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token boolean constant">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="_7、filter方法，使用给定的回调函数过滤集合的内容，只留下那些通过给定真实测试的内容"><a href="#_7、filter方法，使用给定的回调函数过滤集合的内容，只留下那些通过给定真实测试的内容" class="header-anchor">#</a> 7、filter方法，使用给定的回调函数过滤集合的内容，只留下那些通过给定真实测试的内容</h3> <div class="language-php extra-class"><pre class="language-php"><code>   <span class="token comment">/**
     *使用给定的回调函数过滤集合的内容，只留下那些通过给定真实测试的内容
     * @param  callable|null  $callback
     * @return static
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">callable</span> <span class="token variable">$callback</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 有回调函数调用 Arr类中where方法回调过滤处理,实际调用array_filter处理，多传个回调函数处理而已，</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">static</span><span class="token punctuation">(</span>Arr<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">items</span><span class="token punctuation">,</span> <span class="token variable">$callback</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 跟上面一样，只不过少个回调函数而已</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">static</span><span class="token punctuation">(</span><span class="token function">array_filter</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">items</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="_8、sortby方法，通过给定的键对集合进行排序。排序后的集合保留了原数组键"><a href="#_8、sortby方法，通过给定的键对集合进行排序。排序后的集合保留了原数组键" class="header-anchor">#</a> 8、sortBy方法，通过给定的键对集合进行排序。排序后的集合保留了原数组键</h3> <div class="language-php extra-class"><pre class="language-php"><code>    <span class="token comment">/**
     * 通过给定的键对集合进行排序。排序后的集合保留了原数组键
     * @param  callable|string  $callback
     * @param  int  $options
     * @param  bool  $descending
     * @return static
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">sortBy</span><span class="token punctuation">(</span><span class="token variable">$callback</span><span class="token punctuation">,</span> <span class="token variable">$options</span> <span class="token operator">=</span> <span class="token constant">SORT_REGULAR</span><span class="token punctuation">,</span> <span class="token variable">$descending</span> <span class="token operator">=</span> <span class="token boolean constant">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$results</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">// 处理 $callback 参数，返回一个闭包</span>
        <span class="token variable">$callback</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">valueRetriever</span><span class="token punctuation">(</span><span class="token variable">$callback</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 遍历集合中所有内容并将其传递到回调函数中</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">items</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$results</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$callback</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//对$results的值进行排序</span>
        <span class="token variable">$descending</span> <span class="token operator">?</span> <span class="token function">arsort</span><span class="token punctuation">(</span><span class="token variable">$results</span><span class="token punctuation">,</span> <span class="token variable">$options</span><span class="token punctuation">)</span>
            <span class="token punctuation">:</span> <span class="token function">asort</span><span class="token punctuation">(</span><span class="token variable">$results</span><span class="token punctuation">,</span> <span class="token variable">$options</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//排序后的集合保持原有数组索引</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token function">array_keys</span><span class="token punctuation">(</span><span class="token variable">$results</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token variable">$key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$results</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">items</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
       <span class="token comment">// 实例化返回集合</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">static</span><span class="token punctuation">(</span><span class="token variable">$results</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="_9、first方法，返回集合中的第一个元素"><a href="#_9、first方法，返回集合中的第一个元素" class="header-anchor">#</a> 9、first方法，返回集合中的第一个元素</h3> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
     * 返回集合中的第一个元素
     * @param  callable|null  $callback
     * @param  mixed  $default
     * @return mixed
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">first</span><span class="token punctuation">(</span><span class="token keyword">callable</span> <span class="token variable">$callback</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">,</span> <span class="token variable">$default</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 若有回调函数，则调用回调函数处理每一个数据，返回符合条件的第一个元素</span>
        <span class="token comment">// 若无回调函数，则返回集合项中的第一个元素</span>
        <span class="token keyword">return</span> Arr<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">items</span><span class="token punctuation">,</span> <span class="token variable">$callback</span><span class="token punctuation">,</span> <span class="token variable">$default</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre></div><h3 id="_10、groupby方法，根据给定的键对集合内的项目进行分组"><a href="#_10、groupby方法，根据给定的键对集合内的项目进行分组" class="header-anchor">#</a> 10、groupBy方法，根据给定的键对集合内的项目进行分组</h3> <div class="language-php extra-class"><pre class="language-php"><code>  <span class="token comment">/**
     * 根据给定的键对集合内的项目进行分组
     * @param  callable|string  $groupBy
     * @param  bool  $preserveKeys
     * @return static
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">groupBy</span><span class="token punctuation">(</span><span class="token variable">$groupBy</span><span class="token punctuation">,</span> <span class="token variable">$preserveKeys</span> <span class="token operator">=</span> <span class="token boolean constant">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 处理 $callback 参数，返回一个闭包</span>
        <span class="token variable">$groupBy</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">valueRetriever</span><span class="token punctuation">(</span><span class="token variable">$groupBy</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token variable">$results</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
       <span class="token comment">// 遍历集合中所有内容并将其传递到回调函数中</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">items</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$groupKeys</span> <span class="token operator">=</span> <span class="token variable">$groupBy</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//判断是否数组</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$groupKeys</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$groupKeys</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token variable">$groupKeys</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// 遍历集合项的key</span>
            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$groupKeys</span> <span class="token keyword">as</span> <span class="token variable">$groupKey</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$groupKey</span> <span class="token operator">=</span> <span class="token function">is_bool</span><span class="token punctuation">(</span><span class="token variable">$groupKey</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">(</span>int<span class="token punctuation">)</span> <span class="token variable">$groupKey</span> <span class="token punctuation">:</span> <span class="token variable">$groupKey</span><span class="token punctuation">;</span>

                <span class="token comment">//判断key是否存在</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">array_key_exists</span><span class="token punctuation">(</span><span class="token variable">$groupKey</span><span class="token punctuation">,</span> <span class="token variable">$results</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token variable">$results</span><span class="token punctuation">[</span><span class="token variable">$groupKey</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">static</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">//根据给定的键对集合内的项目进行分组</span>
                <span class="token variable">$results</span><span class="token punctuation">[</span><span class="token variable">$groupKey</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">offsetSet</span><span class="token punctuation">(</span><span class="token variable">$preserveKeys</span> <span class="token operator">?</span> <span class="token variable">$key</span> <span class="token punctuation">:</span> <span class="token constant">null</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// new 实例，返回当前集合</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">static</span><span class="token punctuation">(</span><span class="token variable">$results</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/" class="prev router-link-active">
        首页
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.60399f4f.js" defer></script><script src="/blog/assets/js/2.3312aabc.js" defer></script><script src="/blog/assets/js/6.6ba50660.js" defer></script>
  </body>
</html>
